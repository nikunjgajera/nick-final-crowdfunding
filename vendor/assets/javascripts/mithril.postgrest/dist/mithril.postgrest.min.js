"use strict";!function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){var r={},n=e.prop(),o=function(e,r){return r&&t.isFunction(r.config)?t.compose(r.config,e):e},u=function(e){return function(r){return t.each(e,function(e,t){r.setRequestHeader(t,e)}),r}},i=function(e,r){return t.extend({},r,{config:o(u(e),r)})},s={Prefer:"return=representation"};r.token=n,r.loader=function(r,n){var o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],u=e.prop(o),i=e.deferred();return u.load=function(){return u(!0),e.redraw(),n(t.extend({},r,{background:!0})).then(function(t){u(!1),i.resolve(t),e.redraw()},function(t){u(!1),i.reject(t),e.redraw()}),i.promise},u},r.loaderWithToken=function(e,t){return r.loader(e,r.requestWithToken,t)},r.init=function(o,a){return r.request=function(r){var n=function(e){try{return JSON.parse(e.responseText),e.responseText}catch(t){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return e.request(t.extend({extract:n},r,{url:o+r.url}))},r.authenticate=function(){var r=e.deferred();return n()?r.resolve({token:n()}):e.request(t.extend({},a)).then(function(e){n(e.token),r.resolve({token:n()})},function(e){r.reject(e)}),r.promise},r.requestWithToken=function(t){return e.postgrest.authenticate().then(function(){return e.postgrest.request(i({Authorization:"Bearer "+n()},t))},function(){return e.postgrest.request(t)})},r.model=function(n){var o=function(e,t){if(t){var r=function(){var r=(e-1)*t,n=r+t-1;return r+"-"+n};return{"Range-unit":"items",Range:r()}}},a=e.prop(10),c={url:"/"+n},l=function(e,r,n,u){var s=arguments.length<=4||void 0===arguments[4]?{}:arguments[4],a=t.extend({},{Prefer:"count=none"},s,o(r,n));return i(a,t.extend({},u,c,{method:"GET",data:e}))},d=function(t,r){return r.url+="?"+e.route.buildQueryString(t),r},g=function(r){return e.postgrest.request(t.extend({},r,c,{method:"OPTIONS"}))},f=function(e,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=t.extend({},s,n);return i(o,t.extend({},r,c,{method:"POST",data:e}))},p=function(e,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=u(t.extend({},n));return d(e,i(o,t.extend({},r,c,{method:"DELETE"})))},m=function(e,r,n){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],u=t.extend({},s,o);return d(e,i(u,t.extend({},n,c,{method:"PATCH",data:r})))},h=function(e,t,r){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return l(e,t||1,a(),r,n)},v=function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return l(e,1,1,t,r)};return{pageSize:a,getPageOptions:h,getRowOptions:v,patchOptions:m,postOptions:f,deleteOptions:p,getPage:t.compose(r.request,h),getRow:t.compose(r.request,v),patch:t.compose(r.request,m),post:t.compose(r.request,f),deleteRequest:t.compose(r.request,p),getPageWithToken:t.compose(r.requestWithToken,h),getRowWithToken:t.compose(r.requestWithToken,v),patchWithToken:t.compose(r.requestWithToken,m),postWithToken:t.compose(r.requestWithToken,f),deleteWithToken:t.compose(r.requestWithToken,p),options:g}},r},e.postgrest=r}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.filtersVM=function(r){var n={},o=function(){var r=e.prop(""),o=function(e){return arguments.length>0?(r(e),n):r()};return o.toFilter=function(){return t.isString(o())?o().trim():o()},o},u=t.reduce(r,function(e,t,r){return"between"===t?e[r]={lte:o(),gte:o()}:e[r]=o(),e},{order:o()}),i=function(){return t.reduce(u,function(e,n,o){if("order"!==o){var u=r[o];if(t.isFunction(n.toFilter)&&(void 0===n.toFilter()||""===n.toFilter()))return e;if("ilike"===u||"like"===u)e[o]=u+".*"+n.toFilter()+"*";else if("@@"===u)e[o]=u+"."+n.toFilter().replace(/\s+/g,"&");else if("between"===u){if(!n.lte.toFilter()&&!n.gte.toFilter())return e;e[o]=[],n.gte()&&e[o].push("gte."+n.gte.toFilter()),n.lte()&&e[o].push("lte."+n.lte.toFilter())}else"is.null"===u?e[o]=null===n.toFilter()?"is.null":"not.is.null":e[o]=u+"."+n.toFilter()}return e},{})},s=function(){var e=function(){return u.order()&&t.reduce(u.order(),function(e,t,r){return e.push(r+"."+t),e},[]).join(",")},r=e()?{order:e()}:{};return t.extend({},r,i())};return t.extend(n,u,{parameters:s,parametersWithoutOrder:i})}});var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,u=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(a){o=!0,u=a}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw u}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.paginationVM=function(r,n){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],u=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],i=e.prop([]),s=n||"id.desc",a=e.prop({order:s}),c=e.prop(!1),l=e.prop(1),d=e.prop(),g=u?r.getPageWithToken:r.getPage,f=e.prop(),p=function(){var r=e.deferred(),n=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var r=e.getResponseHeader("Content-Range");if(t.isString(r)){var n=r.split("/"),o=_slicedToArray(n,2),u=o[0],i=o[1],s=u.split("-"),a=_slicedToArray(s,2),c=a[0],l=a[1];f(parseInt(i)),d(parseInt(l)-parseInt(c)+1)}try{return JSON.parse(e.responseText),e.responseText}catch(g){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return c(!0),g(a(),l(),{background:!0,extract:n},o).then(function(n){i(t.union(i(),n)),c(!1),r.resolve(i()),e.redraw()},function(t){c(!1),f(0),r.reject(t),e.redraw()}),r.promise},m=function(e){return a(t.extend({order:s},e)),i([]),l(1),p()},h=function(){return d()&&r.pageSize()>d()},v=function(){return l(l()+1),p()};return{collection:i,firstPage:m,isLoading:c,nextPage:v,isLastPage:h,total:f,resultsCount:d}}});